<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>My Docs</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body class="homepage">
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href=".">My Docs</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#1" class="nav-link">Задание 1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#2" class="nav-link">Задание 2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#3" class="nav-link">Задание 3</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#4" class="nav-link">Задание 4</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#5" class="nav-link">Задание 5</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="1">Задание 1</h2>
<h3 id="_1">Клиентская часть</h3>
<p>Устанавливаем сокет клиента по UDP:</p>
<pre><code class="language-Python">import socket

HOST = 'localhost'
PORT = 8081

s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.connect((HOST, PORT))
</code></pre>
<p>Пакуем и отправляем сообщение, получаем ответ от сервера:</p>
<pre><code class="language-Python">message = 'Hello server!'
s.sendto(message.encode('utf-8'), (HOST, PORT))

data = s.recv(1024)
print('Received: ' + data.decode('utf-8'))

s.close()
</code></pre>
<h3 id="_2">Серверная часть</h3>
<p>Устанавливаем сокет сервера по UDP:</p>
<pre><code class="language-Python">import socket
import sys

HOST = 'localhost'
PORT = 8081
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

try:
    s.bind((HOST, PORT))
except socket.error as msg:
    print('Error Code : ' + str(msg[0]) + ' Message ' + msg[1])
</code></pre>
<p>Обрабатываем подключение</p>
<pre><code class="language-Python">while True:

    data, addr = s.recvfrom(1024)
    print('Received: ' + data.decode('utf-8'))

    message = 'Hello, client!'
    s.sendto(message.encode('utf-8'), addr)
</code></pre>
<h2 id="2">Задание 2</h2>
<p>Логика для расчета сторон по теореме Пифагора и валидация сообщения клиента:</p>
<pre><code class="language-Python">def LocateCalculate(data):
    if data[2] == 0:
        return (data[0] ** 2 + data[1] ** 2) ** 0.5
    elif data[1] == 0:
        return (data[2] ** 2 - data[0] ** 2) ** 0.5
    return (data[2] ** 2 - data[1] ** 2) ** 0.5

def CheckMessage(data):
    try:
        val_tuple = tuple(map(int, data.split()))
    except ValueError:
        print('Something went wrong with input')
        return False
    for i in val_tuple:
        if i &lt; 0:
            print('Sides can not be negative')
            return False
    if (val_tuple[2] &lt;= val_tuple[1] or val_tuple[2] &lt;= val_tuple[0]) and val_tuple[2] != 0:
        print('Hypothenus can not be shorter than cathetus')
        return False
    return val_tuple
</code></pre>
<h3 id="_3">Клиентская часть</h3>
<p>Устанавливаем сокет клиента по TCP:</p>
<pre><code class="language-Python">import socket

message = input()

HOST = 'localhost'
PORT = 8081

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((HOST, PORT))
</code></pre>
<p>Логика отправления и приема сообщений:</p>
<pre><code class="language-Python">s.sendall(message.encode('utf-8'))

data = s.recv(1024)
print(data.decode('utf-8'))

data = s.recv(1024)
print(data.decode('utf-8'))

s.close()
</code></pre>
<h3 id="_4">Серверная часть</h3>
<p>Устанавливаем сокет сервера по TCP:</p>
<pre><code class="language-Python">import socket
import sys
from func import LocateCalculate, CheckMessage

HOST = 'localhost'
PORT = 8081
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
    s.bind((HOST, PORT))
except socket.error as msg:
    print('Error Code : ' + str(msg[0]) + ' Message ' + msg[1])

s.listen(10)
</code></pre>
<p>Обрабатываем подключения:</p>
<pre><code class="language-Python">while True:
    conn, addr = s.accept()
    print('Connected with ' + addr[0] + ':' + str(addr[1]))

    data = conn.recv(1024)
    reply = data.decode('utf-8')
    message = 'Pythagorator 3000k\nInsert data like &quot;leg leg hypothenus&quot; using space as separator, mark unknown as &quot;0&quot;, e.g. 0 3 25'
    conn.sendall(message.encode('utf-8'))
    temp = CheckMessage(reply)
    if temp:
        msg = f&quot;The input is: {reply}\nX = {LocateCalculate(temp)}&quot;
        conn.sendto(msg.encode('utf-8'), addr)
        print(f&quot;sent to {addr}&quot;)

    conn.close()
</code></pre>
<h2 id="3">Задание 3</h2>
<h3 id="_5">Клиентская часть</h3>
<p>Инициализация сокета взята из предыдущего упражнения
Отправляем запрос на сервер, получаем ответ:</p>
<pre><code class="language-Python">request = 'GET / HTTP/1.1\r\nHost: localhost\r\n\r\n'
s.sendall(request.encode())

data = s.recv(1024)
print(data.decode('utf-8'))

s.close()
</code></pre>
<h3 id="_6">Серверная часть</h3>
<p>Инициализация сокета взята из предыдущего упражнения
Читаем файл посредством Python:</p>
<pre><code class="language-Python">with open('index.html', 'r') as f:
    file = f.read()
</code></pre>
<p>Отправляем файл каждому подключенному пользователю:</p>
<pre><code class="language-Python">while True:
    conn, addr = s.accept()
    print('Connected with ' + addr[0] + ':' + str(addr[1]))
    conn.sendto(file.encode('utf-8'), addr)
    data = conn.recv(1024)
    conn.close()
</code></pre>
<h2 id="4">Задание 4</h2>
<h3 id="_7">Клиентская часть</h3>
<p>Функция ожидания сообщения:</p>
<pre><code class="language-Python">def WaitForMessage(conn):
    while True:
        try:
            data = conn.recv(1024)
            if data:
                print(data.decode('utf-8'))
        except:
            break
    conn.close()
</code></pre>
<p>Поддержка соединения у клиента:</p>
<pre><code class="language-Python">message = 1
while message:
    th = threading.Thread(target=WaitForMessage, args=(s,))
    th.start()
    message = input()
    s.sendall(message.encode('utf-8'))

s.close()
</code></pre>
<h3 id="_8">Серверная часть</h3>
<p>Функции поддержки массовой рассылки, поддержки эмодзи и ожидания сообщения:</p>
<pre><code class="language-Python">def Emojify(addr):
    emoji = b&quot;\\&quot; + f&quot;U0001F{addr % 1000}&quot;.encode()
    return emoji.decode('unicode_escape')

def SendToAll(msg):
    for i in clients:
        i.send(msg)

def WaitForMessage(addr, conn):
    clients.append(conn)
    while True:
        try:
            data = conn.recv(1024)
            code = Emojify(addr[1])
            message = f&quot;\n[{addr[1]}] {code} says: {data.decode('utf-8')}&quot;
            SendToAll(message.encode('utf-8'))
        except:
            clients.remove(conn)
            SendToAll(f&quot;{code} Disconnected&quot;.encode('utf-8'))
            break
    conn.close()
</code></pre>
<p>Непосредственно основной луп:</p>
<pre><code class="language-Python">s.listen(10)
while True:
    conn, addr = s.accept()
    print('Connected with ' + addr[0] + ':' + str(addr[1]))
    th = threading.Thread(target=WaitForMessage, args=(addr, conn))
    th.start()
</code></pre>
<h2 id="5">Задание 5</h2>
<h3 id="_9">Клиентская часть</h3>
<p>Используется функция ожидания сообщения из прошлого задания, аналогично предыдущим заданиям инициализируется и сокет. Реализация основного лупа у клиента:</p>
<pre><code class="language-Python">header = b'POST /subject HTTP/1.1\r\nHost: localhost\r\nAccept: text/html\r\nContent-Type: application/json\r\n' # темплейт
message = 1
while message:
    th = threading.Thread(target=WaitForMessage, args=(s,))
    th.start()
    key = input('Дисциплина: ') # ждем ввода предмета и оценки
    value = input('Оценка: ')
    son_of_j = json.dumps({key: value}) # создаем json
    request = header + f&quot;Content-Length: {len(son_of_j)}\r\n\r\n&quot;.encode() + json.dumps({key: value}).encode('utf-8')
    s.send(request)
s.close()
</code></pre>
<h3 id="_10">Серверная часть</h3>
<p>Класс Response:</p>
<pre><code class="language-Python">class Response:
    def __init__(self, status, reason, headers=None, body=None):
        self.status = status
        self.reason = reason
        self.headers = headers
        self.body = body

    def return_string(self):
        return f&quot;{self.status} {self.reason} {self.body}&quot;
</code></pre>
<p>Класс Request:</p>
<pre><code class="language-Python">class Request:
    def __init__(self, method, target, version, headers, rfile, conn):
        self.method = method
        self.target = target
        self.version = version
        self.headers = headers
        self.rfile = rfile
        self.conn = conn

    @property
    def path(self):
        return self.url.path

    @property
    @lru_cache(maxsize=None)
    def query(self):
        return parse_qs(self.url.query)

    @property
    @lru_cache(maxsize=None)
    def url(self):
        return urlparse(self.target)

    def body(self):
        size = self.headers.get('Content-Length')
        if not size:
            return None
        return self.rfile.read(size)
</code></pre>
<p>Инициализация сервера и обслуживание клиента:</p>
<pre><code class="language-Python">class HTTPserver():
    def __init__(self, host, port, server_name):
        self._host = host
        self._port = port
        self._server_name = server_name

    def init_socket(self):
        self.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        try:
            self.socket.bind((self._host, self._port))
            self.socket.listen(10)
        except socket.error as msg:
            print('Error Code : ' + str(msg[0]) + ' Message ' + msg[1])

    def launch_server(self):
        self.init_socket()
        while True:
            conn, addr = self.socket.accept()
            print('Connected with ' + addr[0] + ':' + str(addr[1]))
            th = threading.Thread(target=self.serve_client, args=(conn,))
            th.start()

    def serve_client(self, conn):
        while True:
            req = self.parse_request(conn)
            resp = self.handle_request(req)
            conn.send(resp.return_string().encode())
            with open('AcademicPerformance.html') as html:
                conn.send(html.read().encode()) # sending html
        conn.close()
</code></pre>
<p>Парсеры (методы внутри класса HTTPserver):</p>
<pre><code class="language-Python">    def parse_request(self, conn):
        rfile = conn.makefile('rb')
        method, target, ver = self.parse_request_line(rfile)
        headers = self.parse_headers(rfile)
        return Request(method, target, ver, headers, rfile, conn)

    def parse_request_line(self, rfile):
        raw = rfile.readline(MAX_LINE + 1)
        if len(raw) &gt; MAX_LINE:
            raise HTTPError(400, 'Bad request', 'Request line is too long')

        req_line = str(raw, 'iso-8859-1')
        print(req_line)
        words = req_line.split()
        if len(words) != 3:
            raise HTTPError(400, 'Bad request', 'Malformed request line')

        method, target, ver = words
        if ver != 'HTTP/1.1':
            raise HTTPError(505, 'HTTP Version Not Supported')
        return method, target, ver

    def parse_headers(self, rfile):
        headers = []
        while True:
            line = rfile.readline(MAX_LINE + 1)
            if len(line) &gt; MAX_LINE:
                raise HTTPError(494, 'Request header too large')

            if line in (b'\r\n', b'\n', b''):
                break
            headers.append(line)
            if len(headers) &gt; MAX_HEADERS:
                raise HTTPError(494, 'Too many headers')

        sheaders = b''.join(headers).decode('iso-8859-1')
        return Parser().parsestr(sheaders)

    def handle_request(self, req): # решаем кто пост, кто гет
        if req.path == '/subject' and req.method == 'POST':
            return self.handle_post(req)

        if req.path == '/subject' and req.method == 'GET':
            return self.handle_get(req)
</code></pre>
<p>Реализация работы с JSON и обновлением страницы:</p>
<pre><code class="language-Python">    def handle_post(self, req): # успокаиваем пользователя, что мы все прочитали
        content_type = req.headers.get('Content-Type')
        accept = req.headers.get('Accept')
        if ('text/html' in accept) and ('application/json' in content_type): # проверка accept и content-type
            contentType = 'text/html; charset=utf-8'
            body = 'I can read your request'
            son_of_j = self.ExtractJson(req)
            try:
                self.CombineAndSave(son_of_j)
            except:
                return Response(500, 'Internal server error')
        else:
            return Response(406, 'Not Acceptable')
        body = body.encode('utf-8')
        headers = [('Content-Type', contentType), ('Content-Length', len(body))]
        return Response(200, 'OK', headers, body)

    def CombineAndSave(self, d):
        with open('data.json', mode='r', encoding='utf-8') as f:
            data = json.load(f)
            for i in d.keys(): # совмещаем json файлы
                data[i] = data.get(i, [])
                data[i].append(d[i])
        with open('data.json', mode='w', encoding='utf-8') as f: # сохраняем итоговый json
            json.dump(data, f)
        data = json2html.convert(json=data)
        with open('AcademicPerformance.html', 'w') as htmlfile: # создаем html из json
            htmlfile.write(str(data))

    def ExtractJson(self, req): # вытаскиваем контент из реквеста
        json_str = req.rfile.readline(int(req.headers.get('Content-Length')))
        return json.loads(json_str)
</code></pre>
<p>Инициализация и запуск сервера:</p>
<pre><code class="language-Python">a = HTTPserver('localhost', 8081, 'Server')
a.launch_server()
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="js/jquery-3.6.0.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js"></script>
        <script src="search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 1.5.3
Build Date UTC : 2024-01-11 10:49:03.460686+00:00
-->
